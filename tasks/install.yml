---
- name: Install Packages | apt
  apt:
    state: latest
    pkg: "{{ item }}"
  with_items:
    - td-agent
  tags:
    - software-installation
    - using-apt
    - fluentd

- name: Install Packages | apt | libcurl4-openssl-dev
  apt:
    state: latest
    pkg: libcurl4-openssl-dev
  when: "'elasticsearch' in apt_packages"
  tags:
    - software-installation
    - using-apt
    - fluentd-plugin-elasticsearch

- name: Install Packages | gem
  gem:
    state: latest
    name: "fluent-plugin-{{ item }}"
    user_install: no
  with_items: fluentd_plugins
  when: fluentd_plugins is iterable
  tags:
    - software-installation
    - using-gem
    - fluentd
